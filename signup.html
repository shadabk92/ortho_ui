<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediLearn - Create Account</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; }
        .split-screen-container { height: 100vh; }
        .left-panel { background-color: #f0f4f8; position: relative; overflow: hidden; }
        .bg-image { object-fit: cover; width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 0; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(219, 234, 254, 0.9) 0%, rgba(219, 234, 254, 0.7) 50%, rgba(255,255,255,0.4) 100%); z-index: 1; }
        .left-content { position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 3rem; }
        .right-panel { background-color: white; height: 100%; overflow-y: auto; }
        .role-selector { background-color: #f1f5f9; padding: 0.25rem; border-radius: 0.5rem; display: flex; margin-bottom: 1.5rem; }
        .role-btn { flex: 1; text-align: center; padding: 0.5rem; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 600; color: #64748b; border: none; background: transparent; transition: all 0.2s; }
        .role-btn.active { background-color: white; color: #0f172a; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        /* Utilities */
        .social-btn { border: 1px solid #e2e8f0; padding: 0.75rem; border-radius: 0.5rem; width: 100%; background: white; }
    </style>
</head>
<body>

    <div class="container-fluid p-0">
        <div class="row g-0 split-screen-container">
            <div class="col-md-6 left-panel d-none d-md-block">
                <img src="https://images.unsplash.com/photo-1576091160550-217358c7db81?q=80&w=2600&auto=format&fit=crop" alt="Medical Team" class="bg-image">
                <div class="overlay"></div>
                <div class="left-content">
                    <div class="mb-4 text-primary"><i class="fa-solid fa-shield-halved fa-3x"></i></div>
                    <h1 class="h1 fw-bold mb-3">Advancing Medical<br>Excellence, Together.</h1>
                </div>
            </div>

            <div class="col-md-6 right-panel d-flex justify-content-center">
                <div class="w-100 p-4 p-lg-5" style="max-width: 600px;">
                    
                    <div class="d-flex justify-content-between align-items-center mb-5">
                        <span class="fs-4 fw-bold">MediLearn</span>
                        <div class="text-end">
                            <span class="text-secondary small">Already have an account?</span>
                            <a href="signin.html" class="text-primary fw-bold text-decoration-none ms-1 small">Log in</a>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h2 class="fw-bold mb-2">Create Your Account</h2>
                    </div>

                    <label class="form-label fw-bold">Are you a...</label>
                    <div class="role-selector">
                        <button type="button" class="role-btn active" onclick="selectRole('doctor', this)">Doctor</button>
                        <button type="button" class="role-btn" onclick="selectRole('healthcare_professional', this)">Healthcare Professional</button>
                    </div>

                    <form onsubmit="handleSignup(event)">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" id="full_name" class="form-control" placeholder="Enter your full name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <input type="email" id="email" class="form-control" placeholder="you@example.com" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" id="password" class="form-control" placeholder="Enter a secure password" required>
                        </div>

                        <div class="row g-3 mb-4" id="doctor-fields">
                            <div class="col-md-6">
                                <label class="form-label">Medical License Number</label>
                                <input type="text" id="license" class="form-control" placeholder="e.g. 12345678">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Specialty</label>
                                <input type="text" id="specialty" class="form-control" placeholder="e.g. Cardiology">
                            </div>
                        </div>

                        <div class="row g-3 mb-4" id="professional-fields" style="display:none;">
                            <div class="col-md-6">
                                <label class="form-label">Profession</label>
                                <input type="text" id="profession" class="form-control" placeholder="e.g. Nurse, Technician">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Organization</label>
                                <input type="text" id="organization" class="form-control" placeholder="e.g. City Hospital">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mb-4">Create Account</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Default Role
        let selectedRole = "doctor";

        function selectRole(role, btn) {
            selectedRole = role;

            // 1. Update Buttons
            $(".role-btn").removeClass("active");
            $(btn).addClass("active");

            // 2. Toggle Fields
            if (role === "doctor") {
                $("#doctor-fields").show();
                $("#professional-fields").hide();
            } else {
                $("#doctor-fields").hide();
                $("#professional-fields").show();
            }
        }

        function handleSignup(event) {
            event.preventDefault();

            const $btn = $("button[type='submit']");
            
            // Collect Data
            const fullName = $("#full_name").val().trim();
            const email = $("#email").val().trim();
            const password = $("#password").val();
            
            // Role specific data
            const license = $("#license").val();
            const specialty = $("#specialty").val();
            const profession = $("#profession").val();
            const organization = $("#organization").val();

            if (!fullName || !email || !password) {
                alert("Please fill all required fields");
                return;
            }

            // Split name
            const nameParts = fullName.split(" ");
            const firstName = nameParts.shift();
            const lastName = nameParts.join(" ") || ""; // Handle single names

            $btn.prop("disabled", true).text("Creating Account...");

            $.ajax({
                url: "api/auth/signup.php",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    role: selectedRole,
                    first_name: firstName,
                    last_name: lastName,
                    email: email,
                    password: password,
                    // Send all optional fields, PHP will pick what it needs
                    license_number: license,
                    specialty: specialty,
                    profession: profession,
                    organization: organization
                }),
                success: function (res) {
                    if (!res.success) {
                        alert(res.message || "Signup failed");
                        $btn.prop("disabled", false).text("Create Account");
                        return;
                    }
                    alert("Account created successfully!");
                    window.location.href = "signin.html";
                },
                error: function (xhr) {
                    let msg = "Server error";
                    if(xhr.responseJSON && xhr.responseJSON.message) msg = xhr.responseJSON.message;
                    alert(msg);
                    $btn.prop("disabled", false).text("Create Account");
                }
            });
        }
    </script>
</body>
</html>