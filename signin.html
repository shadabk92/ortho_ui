<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediLearn - Log in</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a' }
                    }
                }
            }
        }
    </script>

    <style>
        .fade-enter {
            opacity: 0;
            transform: translateY(5px);
            animation: fadeIn 0.3s forwards ease-out;
        }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="h-screen w-full bg-white overflow-hidden flex">

    <div class="hidden lg:flex lg:w-1/2 relative bg-gray-900 h-full">
        <img src="https://images.unsplash.com/photo-1622253692010-333f2da6031d?q=80&w=2000&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover opacity-60">
        <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/40 to-transparent"></div>
        <div class="relative z-10 p-12 flex flex-col justify-end h-full w-full">
            <div class="mb-6">
                <div class="flex items-center gap-3 mb-4 text-white">
                    <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center border border-white/30">
                        <i class="fa-solid fa-plus text-white text-xl"></i>
                    </div>
                    <span class="text-3xl font-bold tracking-tight">MediLearn</span>
                </div>
                <p class="text-gray-200 text-lg font-light max-w-md leading-relaxed">
                    Advanced Medical Training. Simplified.
                </p>
            </div>
        </div>
    </div>

    <div class="w-full lg:w-1/2 h-full overflow-y-auto flex flex-col items-center justify-center p-6 sm:p-12">
        <div class="w-full max-w-md space-y-8">
            <div class="text-left">
                <h2 class="text-3xl font-bold text-gray-900 tracking-tight">Log in to Your Account</h2>
            </div>

            <div class="flex border-b border-gray-200">
                <button onclick="switchTab('email')" id="tab-email" class="pb-3 px-4 text-sm font-semibold text-brand-600 border-b-2 border-brand-600 transition-colors focus:outline-none">Email</button>
                <button onclick="switchTab('phone')" id="tab-phone" class="pb-3 px-4 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-gray-700 transition-colors focus:outline-none ml-4">Phone</button>
            </div>

            <form onsubmit="handleLogin(event)" class="space-y-6">
                <div class="space-y-1.5" id="input-group">
                    <label id="input-label" for="user-input" class="block text-sm font-medium text-gray-700">Email</label>
                    <div class="relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i id="input-icon" class="fa-regular fa-envelope text-gray-400 text-sm"></i>
                        </div>
                        <input type="email" id="user-input" class="block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 sm:text-sm transition-shadow" placeholder="you@example.com" required>
                    </div>
                </div>

                <div class="space-y-1.5">
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <div class="relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fa-solid fa-lock text-gray-400 text-sm"></i>
                        </div>
                        <input type="password" id="password" class="block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 sm:text-sm transition-shadow" placeholder="Enter your password" required>
                    </div>
                </div>

                <button type="submit" class="w-full flex justify-center py-2.5 px-4 border border-transparent rounded-lg shadow-sm text-sm font-semibold text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 transition-all transform active:scale-[0.98]">Log In</button>
            </form>
        </div>
    </div>

    <script>
        // Track the current method
        let currentTab = 'email';

        // 1. Function to switch Tabs (UI Logic)
        function switchTab(tab) {
            if (currentTab === tab) return;
            currentTab = tab;

            const emailTab = document.getElementById('tab-email');
            const phoneTab = document.getElementById('tab-phone');
            const label = document.getElementById('input-label');
            const input = document.getElementById('user-input');
            const icon = document.getElementById('input-icon');
            const group = document.getElementById('input-group');

            // Animation
            group.classList.remove('fade-enter');
            void group.offsetWidth; // Trigger reflow
            group.classList.add('fade-enter');

            if (tab === 'email') {
                emailTab.className = "pb-3 px-4 text-sm font-semibold text-brand-600 border-b-2 border-brand-600 transition-colors focus:outline-none";
                phoneTab.className = "pb-3 px-4 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-gray-700 transition-colors focus:outline-none ml-4";
                
                label.textContent = "Email";
                input.type = "email";
                input.placeholder = "you@example.com";
                icon.className = "fa-regular fa-envelope text-gray-400 text-sm";
            } else {
                phoneTab.className = "pb-3 px-4 text-sm font-semibold text-brand-600 border-b-2 border-brand-600 transition-colors focus:outline-none ml-4";
                emailTab.className = "pb-3 px-4 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:text-gray-700 transition-colors focus:outline-none";
                
                label.textContent = "Phone Number";
                input.type = "tel";
                input.placeholder = "+91 123 456 7890";
                icon.className = "fa-solid fa-phone text-gray-400 text-sm";
            }
            
            input.value = ""; 
            input.focus();
        }

        // 2. Function to handle Login (Server Logic)
        function handleLogin(e) {
            e.preventDefault();

            const $btn = $("button[type='submit']");
            const identifier = $("#user-input").val();
            const password = $("#password").val();

            if (!identifier || !password) {
                alert("Please enter login details");
                return;
            }

            $btn.html('<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Processing...');
            $btn.prop("disabled", true);

            $.ajax({
                url: "api/auth/login.php",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    method: currentTab, // Uses the variable from above
                    identifier: identifier,
                    password: password
                }),
                success: function (res) {
                    if (!res.success) {
                        alert(res.message);
                        $btn.prop("disabled", false).text("Log In");
                        return;
                    }
                    window.location.href = "learner-dashboard.html";
                },
                error: function (xhr) {
                    // Try to get message from server response, else default
                    let msg = "Invalid credentials";
                    if(xhr.responseJSON && xhr.responseJSON.message) {
                        msg = xhr.responseJSON.message;
                    }
                    alert(msg);
                    $btn.prop("disabled", false).text("Log In");
                }
            });
        }
    </script>
</body>
</html>